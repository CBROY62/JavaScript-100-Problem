<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>User Dashboard</title>
 <link rel="stylesheet" href="style.css">
</head>
<body>

  <nav>
    <h2>User Management</h2>
    <div>Admin Panel</div>
  </nav>

  <div class="container">
    <h1>Last 5 Users</h1>
    <div id="user-list">Loading users...</div>
  </div>

 <script>
const apiURL = 'http://localhost:3000/api/users';

fetch(apiURL)
  .then(res => res.json())
  .then(users => {
    const container = document.getElementById('user-list');
    container.innerHTML = '';

    users.forEach(user => {
      const card = document.createElement('div');
      card.className = 'user-card';

      card.innerHTML = `
        <img src="https://i.pravatar.cc/150?u=${user.email}" />
        <h2 contenteditable="false" class="name">${user.name}</h2>
        <p>Email: <span contenteditable="false" class="email">${user.email}</span></p>
        <p>Phone: <span contenteditable="false" class="phone">${user.phone}</span></p>
        <p>Website: <span contenteditable="false" class="website">${user.website}</span></p>
        <p>Company: <span contenteditable="false" class="company">${user.company?.name || ''}</span></p>
        <div class="actions">
          <button class="btn-edit">Edit</button>
          <button class="btn-save" style="display:none;">Save</button>
          <button class="btn-delete">Delete</button>
        </div>
      `;

      container.appendChild(card);

      const name = card.querySelector('.name');
      const email = card.querySelector('.email');
      const phone = card.querySelector('.phone');
      const website = card.querySelector('.website');
      const company = card.querySelector('.company');

      const editBtn = card.querySelector('.btn-edit');
      const saveBtn = card.querySelector('.btn-save');
      const deleteBtn = card.querySelector('.btn-delete');

      // Enable editing
      editBtn.addEventListener('click', () => {
        [name, email, phone, website, company].forEach(el => el.contentEditable = true);
        editBtn.style.display = 'none';
        saveBtn.style.display = 'inline-block';
      });

      // Save updated user
      saveBtn.addEventListener('click', () => {
        const updated = {
          name: name.innerText.trim(),
          email: email.innerText.trim(),
          phone: phone.innerText.trim(),
          website: website.innerText.trim(),
          company: { name: company.innerText.trim() }
        };

        fetch(`${apiURL}/${user._id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(updated)
        })
        .then(res => {
          if (res.ok) {
            alert('✅ User updated!');
            [name, email, phone, website, company].forEach(el => el.contentEditable = false);
            editBtn.style.display = 'inline-block';
            saveBtn.style.display = 'none';
          } else {
            alert('❌ Failed to update.');
          }
        })
        .catch(err => alert('❌ Server error: ' + err));
      });

      // Delete user
      deleteBtn.addEventListener('click', () => {
        if (confirm(`Delete ${user.name}?`)) {
          fetch(`${apiURL}/${user._id}`, {
            method: 'DELETE'
          })
          .then(res => {
            if (res.ok) {
              alert('🗑️ User deleted!');
              card.remove();
            } else {
              alert('❌ Failed to delete.');
            }
          })
          .catch(err => alert('❌ Server error: ' + err));
        }
      });
    });
  })
  .catch(err => {
    console.error(err);
    document.getElementById('user-list').innerText = 'Error loading users.';
  });
</script>

</body>
</html>
